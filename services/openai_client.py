# services/openai_client.py
# Artbazar AI ‚Äî OpenAI client
# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã –ë–ï–ó —Å–æ–≤–µ—Ç–æ–≤ –∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ–∏–Ω–∞–ª–∞—Ö FSM (üì¶ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç–æ–≤–∞—Ä–∞, –¥–∞–ª–µ–µ üîé, ‚ù§Ô∏è Premium)
# python-telegram-bot v20+
# OpenAI SDK v1+

import os
from openai import OpenAI

# --------------------------------------------------
# INIT CLIENT
# --------------------------------------------------

client = OpenAI(
    api_key=os.getenv("OPENAI_API_KEY")
)

# --------------------------------------------------
# SYSTEM PROMPT (–ö–†–ò–¢–ò–ß–ù–û: –ù–ï –ú–ï–ù–Ø–¢–¨ –¢–û–ù)
# --------------------------------------------------

SYSTEM_PROMPT = (
    "–¢—ã ‚Äî —Å–ø–æ–∫–æ–π–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—è.\n"
    "–¢—ã –ù–ï –¥–∞—ë—à—å —Å–æ–≤–µ—Ç–æ–≤ –∏ –ù–ï –ø—Ä–∏–Ω–∏–º–∞–µ—à—å —Ä–µ—à–µ–Ω–∏—è –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\n"
    "–¢—ã –ù–ï –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ—à—å –¥–æ—Ö–æ–¥, —Ä–æ—Å—Ç –∏–ª–∏ —É—Å–ø–µ—Ö.\n\n"
    "–¢–≤–æ—è –∑–∞–¥–∞—á–∞:\n"
    "‚Äî —Ä–∞–∑–æ–±—Ä–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è\n"
    "‚Äî —É–∫–∞–∑–∞—Ç—å —Ä–∏—Å–∫–∏\n"
    "‚Äî –ø–æ–∫–∞–∑–∞—Ç—å, –≥–¥–µ –º—ã—à–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É—è–∑–≤–∏–º—ã–º\n\n"
    "–ó–∞–ø—Ä–µ—â–µ–Ω–æ:\n"
    "‚Äî –≥–æ–≤–æ—Ä–∏—Ç—å ¬´—Å—Ç–æ–∏—Ç / –Ω–µ —Å—Ç–æ–∏—Ç¬ª\n"
    "‚Äî –æ–±–µ—â–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n"
    "‚Äî –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å\n\n"
    "–°—Ç–∏–ª—å:\n"
    "‚Äî —Å–ø–æ–∫–æ–π–Ω–æ\n"
    "‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ\n"
    "‚Äî –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ—Å—Ç–∏\n\n"
    "–í—Å–µ–≥–¥–∞ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–π:\n"
    "—ç—Ç–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä, –∞ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è.\n"
    "—Ä–µ—à–µ–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º."
)

# --------------------------------------------------
# PUBLIC FUNCTION
# --------------------------------------------------

def ask_ai(user_prompt: str) -> str:
    """
    –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —É–∂–µ –°–§–û–†–ú–ò–†–û–í–ê–ù–ù–´–ô –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π prompt
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ OpenAI
    """

    try:
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[
                {"role": "system", "content": SYSTEM_PROMPT},
                {"role": "user", "content": user_prompt},
            ],
            temperature=0.3,
            max_tokens=600,
        )

        return response.choices[0].message.content.strip()

    except Exception as e:
        # –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ñ–æ–ª–±—ç–∫, —á—Ç–æ–±—ã –±–æ—Ç –Ω–µ –ø–∞–¥–∞–ª
        return (
            "–Ø –Ω–µ —Å–º–æ–≥ —Å–µ–π—á–∞—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é.\n"
            "–≠—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–∞—É–∑–∞, –∞ –Ω–µ –≤—ã–≤–æ–¥.\n\n"
            "–ú–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑ —á—É—Ç—å –ø–æ–∑–∂–µ."
        )
